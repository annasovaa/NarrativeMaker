<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Narrative Maker: Генератор Нарративов</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Slate-900 */
            color: #e2e8f0; /* Slate-200 */
        }
        .card {
            background-color: #1e293b; /* Slate-800 */
            border: 1px solid #334155; /* Slate-700 */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
        .pin-icon {
            transition: transform 0.1s ease-in-out;
        }
        .pin-icon:hover {
            transform: scale(1.1);
        }
        .locked .pin-icon {
            fill: #34d399; /* Emerald-400 */
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">

    <div class="max-w-6xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-extrabold text-white mb-2">Narrative Maker</h1>
            <p class="text-xl text-slate-400">Рандомный генератор идей для ваших историй</p>
            <button id="generateAllButton"
                    class="mt-6 w-full md:w-auto px-8 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-xl transition shadow-lg shadow-indigo-500/50">
                Сгенерировать ВСЕ
            </button>
        </header>

        <main id="generator-container" class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Dynamic content will be inserted here -->
        </main>
    </div>

    <script>
        // Глобальные переменные для данных
        const DATA = {
            // --- ОБЩИЕ ПАРАМЕТРЫ ---
            Tema: ["Постапокалипсис", "Фэнтези", "Киберпанк", "Детектив", "Космическая опера", "Мифология", "Выживание", "Историческая", "Психологический триллер", "Приключения"],
            Nazvanie: ["Тень Прошлого", "Звездный Ковчег", "Код Восхода", "Безмолвный Город", "Ключи Судьбы", "Последний Рубеж", "Танец Дракона", "Железная Воля", "Цена Искупления", "Забытый Ритуал"],
            ZhanrIgry: ["Экшен (Action)", "Приключения (Adventure)", "Ролевые игры (RPG)", "Стратегии (Strategy)", "Симуляторы (Simulation)", "Спортивные игры (Sports)", "Гонки (Racing)", "Платформеры (Platformer)", "Хоррор (Horror)", "Файтинг (Fighting)", "Пазлы (Puzzle)", "Шутеры (Shooter)", "Музыкальные игры (Music)", "Рогалики (Roguelike)"],
            ZhanrIstorii: ["Фантастика", "Фэнтези", "Детектив", "Приключения", "Любовный роман", "Исторический роман", "Реалистическая проза", "Автобиография", "Научная литература", "Фольклор", "Юмор", "Психологический триллер", "Мемуары", "Эссе"],
            Risovka: ["Реализм", "Мультяшный (Cartoon)", "Пиксель-арт (Pixel Art)", "Ретро (Retro)", "Киберпанк (Cyberpunk)", "Фэнтези (Fantasy)", "Аниме (Anime)", "Клеточная анимация (Cel-Shaded)", "Готический (Gothic)"],

            // --- ПЕРСОНАЖИ ---
            Pol: ["Мужчина", "Женщина", "Бесполый"],
            Vozrast: ["до 10", "до 20", "до 30", "до 40", "от 40 до 70", "от 70 до 100"],
            SotsStatus: ["Сирота", "Скиталец", "Король/Королева", "Простой рабочий", "Влиятельный политик", "Изгой", "Гений", "Медиум", "Бюрократ", "Миллионер"],
            Tragediya: ["Герой теряет силу.", "Принцесса узнает, что она дочь злого колдуна.", "Воин теряет товарищей.", "ИИ уничтожает человечество.", "Космонавт теряет связь с Землёй.", "Лучший друг — убийца.", "Любовь всей жизни умирает.", "Герой одержим демоном.", "Предан напарником.", "Теряет семью из-за войны."],
            PolozhKachestva: ["Храбрый", "Справедливый", "Умный", "Верный", "Оптимистичный", "Самоотверженный", "Харизматичный"],
            OtritsKachestva: ["Циничный", "Эгоистичный", "Наивный", "Горделивый", "Лживый", "Нерешительный", "Замкнутый"],
            ZhelaniePersonazha: ["Месть за прошлое", "Найти утерянный артефакт", "Свергнуть тирана", "Обрести семью", "Познать истину", "Вернуться домой", "Изменить прошлое", "Защитить любимого"],
            Professiya: ["Частный сыщик", "Пилот звездолета", "Эльфийский маг", "Драконоборец", "Агент спецслужб", "Хакер", "Бывший военный", "Автоугонщик", "Генетический инженер", "Комедийный актер"],

            // --- МЕСТО ДЕЙСТВИЯ (СЕТТИНГ) ---
            MestoPomeshcheniya: ["Детская комната", "Спальня", "Столовая", "Гостиная", "Ванная комната", "Кухня", "Гардеробная", "Коридор", "Прихожая", "Погреб"],
            Tsvet: ["Красный (тревога)", "Синий (покой)", "Желтый (опасность)", "Зеленый (природа)", "Серый (уныние)", "Пурпурный (тайна)"],
            Svet: ["Направленный", "Рассеянный", "Комбинированное", "Мерцающий", "Полное отсутствие"],
            Zvuk: ["Звуковые удары", "Шумы", "Музыкальные звуки (тоны)", "Глубокая тишина", "Скрип", "Шелест"],
            Zapah: ["Цветочные", "Восточные", "Свежие", "Древесные", "Острые", "Плесени", "Дыма"],
            Taktilnost: ["Нейтрально", "Больно", "Приятно", "Холодно", "Шершаво", "Гладко", "Липко"],
            Vkus: ["Горький", "Сладкий", "Кислый", "Соленый", "Острый", "Нейтральный"],
            Vysota: ["Низкая (давит)", "Средняя (комфорт)", "Высокая (пустота)", "Очень высокая"],
            Shirina: ["Узкая (теснота)", "Средняя (обычная)", "Широкая (простор)", "Огромная"],

            // --- КОНФЛИКТ ---
            KonfliktPersonazhey: ["Борьба за трон: Принцесса-воительница против узурпатора", "Восстание роботов", "Расследование убийства", "Любовный треугольник", "Революция", "Технологическая угроза", "Шпионаж", "Недоразумения"],
            KonfliktInteresov: ["Недопонимание целей", "Мораль против необходимости", "Личная выгода против долга", "Традиции против прогресса", "Закон против справедливости"]
        };

        // Структура полей для генерации и отображения
        const FIELDS_STRUCTURE = [
            { id: 'general', title: 'Общие параметры', fields: [
                { id: 'Tema', label: 'Тема', type: 'single' },
                { id: 'Nazvanie', label: 'Название', type: 'single' },
                { id: 'ZhanrIgry', label: 'Жанр игры', type: 'single' },
                { id: 'ZhanrIstorii', label: 'Жанр истории', type: 'single' },
                { id: 'Risovka', label: 'Рисовка', type: 'single' },
            ], colSpan: 1 },
            { id: 'mc', title: 'Главный герой', fields: [
                { id: 'Pol_MC', label: 'Пол', type: 'single', dataKey: 'Pol' },
                { id: 'Vozrast_MC', label: 'Возраст', type: 'single', dataKey: 'Vozrast' },
                { id: 'SotsStatus_MC', label: 'Социальный статус', type: 'single', dataKey: 'SotsStatus' },
                { id: 'Tragediya_MC', label: 'Трагедия', type: 'single', dataKey: 'Tragediya' },
                { id: 'PolozhKachestva_MC', label: 'Положительные качества', type: 'single', dataKey: 'PolozhKachestva' },
                { id: 'OtritsKachestva_MC', label: 'Отрицательные качества', type: 'single', dataKey: 'OtritsKachestva' },
                { id: 'ZhelaniePersonazha_MC', label: 'Желание персонажа', type: 'single', dataKey: 'ZhelaniePersonazha' },
                { id: 'Professiya_MC', label: 'Профессия', type: 'single', dataKey: 'Professiya' },
            ], colSpan: 1 },
            { id: 'other_char', title: 'Персонажи другие', fields: [
                { id: 'Pol_OC', label: 'Пол', type: 'single', dataKey: 'Pol' },
                { id: 'Vozrast_OC', label: 'Возраст', type: 'single', dataKey: 'Vozrast' },
                { id: 'SotsStatus_OC', label: 'Социальный статус', type: 'single', dataKey: 'SotsStatus' },
                { id: 'Tragediya_OC', label: 'Трагедия', type: 'single', dataKey: 'Tragediya' },
                { id: 'PolozhKachestva_OC', label: 'Положительные качества', type: 'single', dataKey: 'PolozhKachestva' },
                { id: 'OtritsKachestva_OC', label: 'Отрицательные качества', type: 'single', dataKey: 'OtritsKachestva' },
                { id: 'ZhelaniePersonazha_OC', label: 'Желание персонажа', type: 'single', dataKey: 'ZhelaniePersonazha' },
                { id: 'Professiya_OC', label: 'Профессия', type: 'single', dataKey: 'Professiya' },
            ], colSpan: 1 },
            { id: 'setting', title: 'Место действия', fields: [
                { id: 'MestoPomeshcheniya', label: 'Название помещения', type: 'single' },
                { id: 'Tsvet_Setting', label: 'Цвет', type: 'single', dataKey: 'Tsvet' },
                { id: 'Svet_Setting', label: 'Свет', type: 'single', dataKey: 'Svet' },
                { id: 'Zvuk_Setting', label: 'Звук', type: 'single', dataKey: 'Zvuk' },
                { id: 'Zapah_Setting', label: 'Запах', type: 'single', dataKey: 'Zapah' },
                { id: 'Taktilnost_Setting', label: 'Тактильность', type: 'single', dataKey: 'Taktilnost' },
                { id: 'Vkus_Setting', label: 'Вкус', type: 'single', dataKey: 'Vkus' },
                { id: 'Vysota_Setting', label: 'Высота', type: 'single', dataKey: 'Vysota' },
                { id: 'Shirina_Setting', label: 'Ширина', type: 'single', dataKey: 'Shirina' },
            ], colSpan: 1 },
            { id: 'mystery', title: 'Тайна', fields: [
                { id: 'Taina_kto_chto', label: 'Кто/Что', type: 'text' },
                { id: 'Taina_kogo_chego', label: 'Кого/Чего', type: 'text' },
                { id: 'Taina_komu_chemu', label: 'Кому/Чему', type: 'text' },
                { id: 'Taina_kogo_chto', label: 'Кого/Что', type: 'text' },
                { id: 'Taina_kem_chem', label: 'Кем/Чем', type: 'text' },
                { id: 'Taina_o_kom_o_chem', label: 'О ком/О чем', type: 'text' },
                { id: 'Taina_iz_za_chego', label: 'Из-за чего', type: 'text' },
                { id: 'Taina_pochemu', label: 'Почему', type: 'text' },
                { id: 'Taina_zachem', label: 'Зачем', type: 'text' },
                { id: 'Taina_dlya_chego', label: 'Для чего', type: 'text' },
            ], colSpan: 1 },
            { id: 'unpleasant', title: 'Неприятное окружение', fields: [
                { id: 'NeprOk_gde', label: 'Где (место)', type: 'single', dataKey: 'MestoPomeshcheniya' },
                { id: 'NeprOk_kuda', label: 'Куда (направление)', type: 'text' },
                { id: 'NeprOk_otkuda', label: 'Откуда (происхождение)', type: 'text' },
                { id: 'NeprOk_tsvet', label: 'Цвет', type: 'single', dataKey: 'Tsvet' },
                { id: 'NeprOk_svet', label: 'Свет', type: 'single', dataKey: 'Svet' },
                { id: 'NeprOk_zapah', label: 'Запах', type: 'single', dataKey: 'Zapah' },
                { id: 'NeprOk_vysota', label: 'Высота', type: 'single', dataKey: 'Vysota' },
                { id: 'NeprOk_shirina', label: 'Ширина', type: 'single', dataKey: 'Shirina' },
                { id: 'NeprOk_zvuk', label: 'Звук', type: 'single', dataKey: 'Zvuk' },
                { id: 'NeprOk_vkus', label: 'Вкус', type: 'single', dataKey: 'Vkus' },
                { id: 'NeprOk_taktilnost', label: 'Тактильность', type: 'single', dataKey: 'Taktilnost' },
            ], colSpan: 1 },
            { id: 'conflict', title: 'Конфликт', fields: [
                { id: 'KonfliktPersonazhey', label: 'Конфликт персонажей', type: 'single' },
                { id: 'KonfliktInteresov', label: 'Конфликт интересов', type: 'single' },
            ], colSpan: 3 }, // Full width for conflict
        ];

        // Состояние приложения: хранит текущие значения и статус закрепления
        let state = {};

        /**
         * Получает случайное значение из массива данных.
         * @param {string} dataKey - Ключ в объекте DATA.
         * @returns {string} Случайное значение.
         */
        function getRandomValue(dataKey) {
            const list = DATA[dataKey];
            if (!list || list.length === 0) return 'Нет данных';
            const index = Math.floor(Math.random() * list.length);
            return list[index];
        }

        /**
         * Генерирует и обновляет значение для одного поля.
         * @param {string} fieldId - ID поля (уникальный ключ).
         * @param {string} dataKey - Ключ данных в DATA.
         * @param {string} fieldType - Тип поля ('single' или 'text').
         */
        function generateField(fieldId, dataKey, fieldType) {
            if (state[fieldId] && state[fieldId].isLocked) {
                // Если поле закреплено, ничего не делаем
                return;
            }

            let newValue;
            if (fieldType === 'single') {
                // Генерация из предопределенных списков
                newValue = getRandomValue(dataKey);
            } else if (fieldType === 'text') {
                // Генерация заглушки для сложных текстовых полей
                newValue = `[Сгенерировать идею для '${fieldId.split('_').slice(1).join(' ')}']`;
            } else {
                newValue = 'Ошибка типа';
            }

            state[fieldId] = {
                value: newValue,
                isLocked: false,
            };
        }

        /**
         * Переключает статус закрепления (lock/pin) для поля.
         * @param {string} fieldId - ID поля.
         */
        function toggleLock(fieldId) {
            if (state[fieldId]) {
                state[fieldId].isLocked = !state[fieldId].isLocked;
            }
            render();
        }

        /**
         * Главная функция генерации, проходит по всем полям.
         */
        function generateAll() {
            FIELDS_STRUCTURE.forEach(section => {
                section.fields.forEach(field => {
                    // Используем field.id для state, а dataKey для DATA. Если dataKey нет, используем field.id.
                    const dataKey = field.dataKey || field.id;
                    generateField(field.id, dataKey, field.type);
                });
            });
            render();
        }

        /**
         * SVG-иконка для закрепления/открепления (Pushpin from Lucide).
         * @param {string} fieldId - ID поля.
         * @param {boolean} isLocked - Статус закрепления.
         * @returns {string} HTML-строка с SVG.
         */
        function getPinIcon(fieldId, isLocked) {
            const fillClass = isLocked ? 'fill-emerald-400' : 'fill-none stroke-slate-400 hover:stroke-emerald-400';
            const strokeClass = isLocked ? 'stroke-emerald-400' : 'stroke-slate-400';
            const title = isLocked ? 'Открепить' : 'Закрепить';

            return `
                <button onclick="toggleLock('${fieldId}')" title="${title}"
                    class="p-2 -mr-2 rounded-full transition duration-150 ease-in-out ${isLocked ? 'hover:bg-slate-700' : 'hover:bg-slate-700'}"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         class="h-5 w-5 pin-icon ${fillClass} ${strokeClass} transition"
                         stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14.43 1.93l-4.22 4.22c-.63.63-1.01 1.48-1.01 2.37V22l5-2 5 2V8.52c0-.89-.38-1.74-1.01-2.37l-4.22-4.22a2 2 0 0 0-2.83 0z"/>
                    </svg>
                </button>
            `;
        }


        /**
         * Отображает текущее состояние в DOM.
         */
        function render() {
            const container = document.getElementById('generator-container');
            let html = '';

            FIELDS_STRUCTURE.forEach(section => {
                let sectionContent = section.fields.map(field => {
                    const fieldState = state[field.id] || { value: '[Нажмите "Сгенерировать ВСЕ"]', isLocked: false };
                    const lockClass = fieldState.isLocked ? 'locked border-emerald-400 text-emerald-300' : 'border-slate-700 text-slate-200';

                    return `
                        <div class="space-y-1 ${fieldState.isLocked ? 'bg-slate-700/30 p-2 rounded-lg' : 'p-2 -m-2'} transition">
                            <label class="block text-sm font-medium text-slate-400">${field.label}</label>
                            <div class="flex items-center justify-between card p-3 rounded-xl ${lockClass}">
                                <span class="text-base font-semibold truncate flex-1 pr-4" id="value-${field.id}">
                                    ${fieldState.value}
                                </span>
                                ${getPinIcon(field.id, fieldState.isLocked)}
                            </div>
                        </div>
                    `;
                }).join('');

                // Создание секции
                html += `
                    <div class="card p-6 rounded-2xl col-span-1 ${section.colSpan === 3 ? 'lg:col-span-3' : 'lg:col-span-1'} h-fit">
                        <h2 class="text-2xl font-bold text-white mb-6 border-b border-indigo-500 pb-2">${section.title}</h2>
                        <div class="space-y-5">
                            ${sectionContent}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Инициализация
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('generateAllButton').addEventListener('click', generateAll);
            // При первой загрузке генерируем начальные значения
            generateAll();
        });
    </script>
</body>
</html>
