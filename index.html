<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Генератор Нарративных Идей</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }
        .container {
            width: 100%;
            max-width: 900px;
            padding: 2rem;
            margin-top: 2rem;
        }
        .card {
            background-color: white;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 2rem;
        }
        .result-item {
            display: flex;
            margin-bottom: 0.75rem;
            border-left: 4px solid #3b82f6; /* Blue border */
            padding-left: 1rem;
        }
        .result-label {
            font-weight: 600;
            width: 30%;
            min-width: 120px;
            color: #1e3a8a; /* Dark blue for label */
        }
        .result-value {
            flex-grow: 1;
            color: #333;
        }
        @media (max-width: 640px) {
            .result-item {
                flex-direction: column;
                padding-bottom: 0.5rem;
                border-left: none;
                border-bottom: 2px dashed #93c5fd; /* Light blue dashed separator */
            }
            .result-label {
                width: 100%;
                margin-bottom: 0.25rem;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container">
        <div class="card">
            <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Генератор Нарративных Идей</h1>
            <p class="text-center text-gray-600 mb-8">Нажмите кнопку, чтобы получить случайный набор элементов для вашей истории.</p>

            <button id="generateBtn" 
                    class="w-full py-4 mb-8 bg-indigo-600 hover:bg-indigo-700 text-white font-bold text-xl rounded-xl shadow-lg 
                           transition duration-300 transform hover:scale-105 active:scale-95">
                Сгенерировать Идею
            </button>

            <div id="results" class="space-y-4">
                <!-- Результаты будут здесь -->
            </div>
            
            <div id="loadingIndicator" class="hidden text-center mt-6 text-indigo-600 font-semibold">
                Загрузка данных...
            </div>
        </div>
    </div>

    <script>
        // Исходные данные из загруженных CSV-файлов
        // Все данные очищены от лишних кавычек и пробелов, и объединены в массивы для простоты случайного выбора.

        const csvData = {
            'Темы': `Тема,Описание
Постапокалипсис,"Мир после глобальной катастрофы, где выжившие борются за ресурсы и власть. Исследование разрушенных городов и поиск артефактов прошлого."
Фэнтези,"Средневековый мир с магией, драконами и рыцарями. Эпическое путешествие героя для спасения королевства."
Киберпанк,"Будущее, где технологии и корпорации правят миром. Хакеры и киборги в борьбе за свободу и справедливость."
Детектив,Расследование сложных преступлений в мрачном городе. Поиск улик и допрос подозреваемых.
Космическая опера,"Путешествия по галактике, встречи с инопланетными расами и космические битвы. Исследование новых планет и открытие тайн вселенной."
Мифология,"Мир, основанный на древних мифах и легендах. Взаимодействие с богами и мифическими существами."
Выживание,"Борьба за выживание в экстремальных условиях (джунгли, пустыня, Арктика). Построение убежища и поиск пищи."
Историческая,Воссоздание реальных исторических событий и эпох. Участие в значимых битвах и политических интригах.
Психологический триллер,Исследование человеческого разума и его тайн. Погружение в мир иллюзий и кошмаров.
Приключения,Путешествия по экзотическим местам и решение головоломок. Поиск сокровищ и древних артефактов.`,
            
            'Жанр игры': `Жанр,Описание
Экшен (Action),"Игры, в которых основной акцент делается на физические испытания и реакцию игрока."
Приключения (Adventure),"Игры, сосредоточенные на исследовании мира и решении головоломок."
Ролевые игры (RPG),"Игры, в которых игрок управляет персонажем или группой персонажей, развивая их навыки и способности."
Стратегии (Strategy),"Игры, требующие от игрока планирования и тактического мышления для достижения целей."
Симуляторы (Simulation),"Игры, имитирующие реальные или вымышленные процессы и ситуации."
Спортивные игры (Sports),"Игры, моделирующие различные виды спорта."
Гонки (Racing),"Игры, в которых игрок участвует в гонках на различных транспортных средствах."
Платформеры (Platformer),"Игры, в которых игрок управляет персонажем, прыгающим по платформам и преодолевающим препятствия."
Хоррор (Horror),"Игры, созданные для того, чтобы пугать и вызывать чувство напряжения у игрока."
Файтинг (Fighting),"Игры, в которых игроки сражаются друг с другом или с компьютерными противниками в рукопашных боях."
Пазлы (Puzzle),"Игры, в которых игрок решает головоломки для продвижения по сюжету или достижения целей."
Шутеры (Shooter),"Игры, в которых основной акцент делается на стрельбу и уничтожение врагов."
Музыкальные игры (Music),"Игры, в которых игрок взаимодействует с музыкой, следуя ритму и мелодии."
Рогалики (Roguelike),Игры с процедурно генерируемыми уровнями и перманентной смертью.`,

            'Жанр истории': `Жанр,Описание
Фантастика,"Произведения, описывающие вымышленные миры и технологии."
Фэнтези,"Истории, основанные на магии и мифологических существах."
Детектив,"Произведения, сосредоточенные на расследовании преступлений."
Приключения,"Книги, описывающие захватывающие путешествия и события."
Любовный роман,Истории о романтических отношениях между персонажами.
Исторический роман,"Произведения, основанные на реальных исторических событиях и эпохах."
Реалистическая проза,"Книги, описывающие реальные жизненные ситуации и проблемы."
Автобиография,"Произведения, в которых автор рассказывает о своей жизни."
Научная литература,"Книги, посвященные научным исследованиям и открытиям."
Фольклор,"Произведения, основанные на народных сказаниях, мифах и легендах."
Юмор,"Книги, написанные с целью развлечь и рассмешить читателя."
Психологический триллер,"Произведения, исследующие человеческий разум и его тайны."
Мемуары,Личные воспоминания автора о значимых событиях и людях.
Эссе,"Краткие произведения, выражающие личные мысли и взгляды автора."`,

            'Рисовка': `Стиль,Описание
Реализм,"Стремление к максимально точному воспроизведению реальной жизни с детализированными персонажами и окружением. Примеры: The Last of Us, Red Dead Redemption 21."
Мультяшный (Cartoon),"Яркие цвета, стилизованные персонажи и окружение, напоминающие анимационные фильмы. Примеры: The Legend of Zelda: Wind Waker, Borderlands1."
Пиксель-арт (Pixel Art),"Графика, созданная с использованием пикселей, напоминающая старые 8-битные и 16-битные игры. Примеры: Celeste, Stardew Valley."
Ретро (Retro),"Стиль, вдохновленный играми 80-х и 90-х годов, с упрощенной графикой и ограниченной цветовой палитрой. Примеры: Shovel Knight, Undertale."
Киберпанк (Cyberpunk),"Темные, футуристические визуальные элементы с акцентом на неоновые цвета и высокие технологии. Примеры: Cyberpunk 2077, Deus Ex."
Фэнтези (Fantasy),"Визуальный стиль, включающий магические элементы, мифических существ и сказочные пейзажи. Примеры: The Witcher 3, Final Fantasy серии."
Аниме (Anime),"Стиль, вдохновленный японской анимацией, с характерными чертами персонажей и яркими цветами. Примеры: Ni no Kuni, Dragon Ball Z: Kakarot."
Клеточная анимация (Cel-Shaded),"Техника, придающая 3D-графике вид 2D-анимации с четкими контурами и яркими цветами. Примеры: Borderlands, Okami1."
Готический (Gothic),"Темные, мрачные визуальные элементы с акцентом на архитектуру и сверхъестественное. Примеры: Dark Souls, Bloodborne."`,

            'Анимация': `Вид анимации,Описание
Скелетная анимация (Skeletal Animation),"Использование костей и суставов для анимации персонажей и объектов. Примеры: The Elder Scrolls V: Skyrim, Overwatch1."
Ключевая анимация (Keyframe Animation),"Создание ключевых кадров, между которыми автоматически генерируются промежуточные кадры. Примеры: Street Fighterсерии, Cuphead."
Морфинг (Morphing),"Плавное изменение формы объекта или персонажа. Примеры: Spore, ClayFighter."
Физическая анимация (Physics-Based Animation),"Анимация, основанная на физических законах, таких как гравитация и столкновения. Примеры: Half-Life 2, Garry’s Mod."
Машинная анимация (Machinima),"Использование игровых движков для создания анимационных фильмов. Примеры: Red vs. Blue(на основе Halo), The Sims серии."
Захват движения (Motion Capture),"Запись движений реальных актеров для создания реалистичной анимации. Примеры: Uncharted серии, The Last of Us2."
Спрайтовая анимация (Sprite Animation),"Использование двухмерных изображений (спрайтов) для создания анимации. Примеры: Super Mario Bros., Shovel Knight."
Процедурная анимация (Procedural Animation),"Анимация, генерируемая алгоритмами в реальном времени. Примеры: No Man’s Sky, Spore."
Заставочная анимация (Cutscene Animation),"Анимация, используемая для создания сюжетных роликов и кат-сцен. Примеры: Final Fantasyсерии, Metal Gear Solidсерии3."`,
            
            'Чувство достижения': `Тип задания,Описание
Основные квесты,"Завершение главных сюжетных миссий, которые продвигают историю игры. Примеры: спасение мира, победа над главным злодеем."
Побочные квесты,"Дополнительные задания, которые обогащают основной сюжет и дают возможность глубже погрузиться в мир игры. Примеры: помощь NPC, исследование скрытых локаций."
Испытания,"Задания, требующие от игрока выполнения сложных действий или преодоления трудных препятствий. Примеры: победа в турнире, прохождение уровня без урона."
Сбор коллекций,"Задания, связанные с поиском и сбором определенных предметов или артефактов. Примеры: сбор всех сокровищ, нахождение всех скрытых предметов."
Достижения (Achievements),"Специальные задания, которые могут быть связаны с прогрессом прохождения, стилем игры или поиском секретов. Примеры: завершение игры на максимальной сложности, выполнение всех побочных квестов1."
Гринд-задания,"Задания, требующие повторения определенных действий для достижения цели. Примеры: накопление определенного количества ресурсов, повышение уровня персонажа."
Социальные задания,"Задания, связанные с взаимодействием с другими игроками. Примеры: участие в гильдии, победа в PvP-сражениях."
Тайм-атак (Time Attack),"Задания, требующие выполнения определенных действий за ограниченное время. Примеры: прохождение уровня за определенное время, победа над боссом в тайм-атаке."
Скрытые задания,"Задания, которые игроки могут найти только при определенных условиях или после выполнения определенных действий. Примеры: нахождение секретных локаций, выполнение скрытых условий для открытия задания."
Креативные задания,"Задания, которые поощряют творчество и нестандартное мышление. Примеры: создание уникального предмета, разработка собственной стратегии для победы."`,

            'Трагедия ГГ': `Жанр,Примеры трагедии главного героя
Фэнтези,"1. Герой теряет магическую силу, которая была его единственной защитой.","2. Принцесса узнает, что она на самом деле дочь злого колдуна.","3. Воин теряет всех своих товарищей в битве.","4. Маг случайно уничтожает свой родной город.","5. Герой оказывается предателем, не зная об этом."
Научная фантастика,"1. Учёный создаёт искусственный интеллект, который уничтожает человечество.","2. Космонавт теряет связь с Землёй и остаётся один в космосе.","3. Герой узнаёт, что он клон и его воспоминания ложны.","4. Вирус, созданный для лечения, превращает людей в монстров.","5. Путешественник во времени случайно стирает своё существование."
Детектив,"1. Детектив обнаруживает, что его лучший друг — убийца.","2. Герой теряет семью из-за мести преступника.","3. Полицейский подставлен и обвинён в преступлении, которого не совершал.","4. Частный сыщик узнаёт, что его клиент — серийный убийца.","5. Герой раскрывает дело, но теряет свою репутацию и работу."
Роман,"1. Любовь всей жизни героя умирает от неизлечимой болезни.","2. Герой узнаёт, что его возлюбленная замужем.","3. Пара не может быть вместе из-за социальных различий.","4. Герой жертвует своей любовью ради счастья другого.","5. Любовь героя оказывается предательницей."
Ужасы,"1. Герой становится одержимым демоном.","2. Семья героя погибает в результате проклятия.","3. Герой оказывается заперт в доме с призраками.","4. Герой узнаёт, что он сам — монстр.","5. Герой теряет рассудок из-за постоянного страха."
Приключения,"1. Герой теряет своего лучшего друга в опасном путешествии.","2. Герой оказывается преданным своим напарником.","3. Герой попадает в ловушку и не может выбраться.","4. Герой теряет карту сокровищ и все надежды на успех.","5. Герой вынужден оставить свою мечту ради спасения других."
Исторический,"1. Герой теряет семью во время войны.","2. Герой оказывается предателем своей страны.","3. Герой не может предотвратить трагическое событие.","4. Герой теряет всё своё состояние из-за политических интриг.","5. Герой вынужден жить в изгнании."
Психологический триллер,"1. Герой теряет рассудок из-за постоянного стресса.","2. Герой узнаёт, что его близкий человек — манипулятор.","3. Герой становится жертвой своих собственных страхов.","4. Герой оказывается в ловушке своих иллюзий.","5. Герой вынужден убить своего близкого человека, чтобы спастись."`,
            
            'Главный герой': `Жанр,Примеры главных героев
Фэнтези,"1. Эльфийский маг: Мудрый и могущественный маг, стремящийся спасти свой мир от зла.","2. Драконоборец: Храбрый воин, сражающийся с драконами, чтобы защитить свое королевство","3. Принцесса-воительница: Наследница трона, которая берет меч, чтобы защитить свой народ.","4. Темный рыцарь: Герой с таинственным прошлым, стремящийся искупить свои грехи","5. Лесной дух: Защитник природы, обладающий магическими способностями."
Научная фантастика,"1. Космический исследователь: Храбрый астронавт, исследующий неизведанные планеты.","2. Кибернетический детектив: Полу-робот, расследующий преступления в будущем.","3. Генетический инженер: Ученый, создающий новые формы жизни.","4. Пилот звездолета: Командир космического корабля, ведущий свою команду через галактику.","5. Искусственный интеллект: Робот, стремящийся понять человеческую природу."
Детектив,"1. Частный сыщик: Умный и проницательный детектив, раскрывающий сложные преступления.","2. Полицейский инспектор: Опытный офицер, борющийся с преступностью в большом городе.","3. Журналист-расследователь: Репортер, раскрывающий коррупционные схемы.","4. Судебный эксперт: Специалист по криминалистике, помогающий в расследовании.","5. Адвокат: Защитник, борющийся за справедливость в суде."
Исторический,"1. Революционер: Герой, который борется за свободу и справедливость.","2. Путешественник: Исследователь, открывающий новые земли и культуры.","3. Монах: Человек, посвятивший свою жизнь духовным поискам и помощи другим.","4. Купец: Предприниматель, строящий свою империю в трудные времена.","5. Дипломат: Представитель страны, ведущий переговоры в сложных ситуациях."
Фантастика,"1. Изобретатель: Гениальный ученый, создающий удивительные устройства и машины.","2. Путешественник во времени: Герой, который перемещается через эпохи, чтобы исправить ошибки прошлого.","3. Супергерой: Человек с необычными способностями, защищающий мир от зла.","4. Альтернативный историк: Ученый, исследующий параллельные вселенные.","5. Киборг: Полу-человек, полу-машина, борющийся за свое место в мире."
Триллер,"1. Агент спецслужб: Опытный агент, предотвращающий глобальные угрозы и заговоры.","2. Хакер: Гений компьютерных технологий, раскрывающий опасные секреты.","3. Журналист: Репортер, расследующий опасные и сенсационные истории.","4. Бывший военный: Ветеран, который использует свои навыки для борьбы с преступностью.","5. Психолог: Специалист, который помогает раскрывать преступления, анализируя поведение людей."
Юмор,"1. Комедийный актер: Веселый и находчивый человек, попадающий в забавные ситуации.","2. Неудачливый изобретатель: Человек, чьи изобретения всегда приводят к комичным последствиям.","3. Саркастичный кот: Животное, которое может говорить и комментировать действия людей.","4. Лентяй: Человек, который пытается избежать работы и попадает в смешные ситуации.","5. Суперфанат: Человек, одержимый своим кумиром, который пытается подражать ему."`,

            'Место действия': `Жанр,Примеры мест действия
Фэнтези,"1. Волшебный лес: Таинственный лес, населенный магическими существами.","2. Средневековый замок: Огромный замок с множеством тайн и секретов.","3. Подземное королевство: Мир под землей, населенный гномами и другими существами.","4. Летающий остров: Остров, парящий в небе, полный чудес и опасностей.","5. Древний храм: Заброшенный храм, скрывающий древние артефакты и магию.","6. Магическая академия: Школа для юных волшебников и ведьм.","7. Зачарованное озеро: Озеро, обладающее магическими свойствами."," 8. Город эльфов: Уединенное место, где живут эльфы.","9. Пещеры драконов: Место, где обитают драконы.","10. Зачарованный сад: Сад, полный магических растений и существ."
Научная фантастика,"1. Космическая станция: Огромная станция на орбите далекой планеты.","2. Постапокалиптический город: Город, разрушенный катастрофой, где выживают только сильнейшие.","3. Подводный город: Город, построенный под водой, с уникальной экосистемой.","4. Марсианская колония: Поселение на Марсе, где люди пытаются создать новую жизнь.","5. Виртуальная реальность: Мир, созданный компьютером, где можно реализовать любые фантазии.","6. Звездный корабль: Судно, путешествующее через галактику.","7. Город роботов: Место, где живут и работают роботы.","8. Лунная база: Научно-исследовательская база на Луне.","9. Астероидный пояс: Место, где добывают ценные ресурсы.","10. Планета-сад: Экзотическая планета с уникальной флорой и фауной."
Триллер,"1. Большой город: Мегаполис с множеством преступлений и загадок.","2. Заброшенный завод: Место, где происходят опасные и незаконные действия.","3. Элитный район: Район, где живут богатые и влиятельные люди, скрывающие свои тайны.","4. Секретная база: Место, где проводятся опасные эксперименты.","5. Пустыня: Изолированное место, где можно скрыться от закона.","6. Подземный бункер: Место, где скрываются от глобальных угроз.","7. Заброшенная больница: Место, полное тайн и опасностей.","8. Яхта в открытом море: Изолированное место, где происходят опасные события.","9. Тайный клуб: Место, где собираются влиятельные люди и происходят заговоры.","10. Горный приют: Уединенное место, где происходят опасные события."
Юмор,"1. Офис: Место, где происходят забавные и нелепые ситуации.","2. Школа: Учебное заведение, полное смешных и курьезных моментов.","3. Съемочная площадка: Место, где снимаются комедийные фильмы и шоу.","4. Кемпинг: Лагерь, где происходят забавные приключения.","5. Цирк: Место, где работают клоуны и акробаты.","6. Рынок: Место, где торгуют и общаются люди.","7. Общественный транспорт: Место, где происходят забавные встречи.","8. Музей: Место, где происходят неожиданные открытия.","9. Зоопарк: Место, где животные ведут себя непредсказуемо.","10. Парк аттракционов: Место, где люди веселятся и попадают в забавные ситуации."`,

            'Конфликт персонажей': `Жанр,Примеры конфликтов персонажей
Фэнтези,"1. Борьба за трон: Принцесса-воительница против узурпатора, захватившего трон.","2. Магическая дуэль: Эльфийский маг против темного колдуна.","3. Война рас: Люди против орков за контроль над землями.","4. Предательство: Рыцарь против своего бывшего друга, ставшего предателем.","5. Поиск артефакта: Группа героев против злого мага, стремящегося заполучить могущественный артефакт."
Научная фантастика,1. Восстание роботов: Люди против восставших роботов. "2. Космическая война: Космический исследователь против инопланетных захватчиков.","3. Этические дилеммы: Генетический инженер против общества, не принимающего его эксперименты.","4. Борьба за ресурсы: Колонисты на Марсе против корпорации, контролирующей ресурсы.","5. Искусственный интеллект: Человек против ИИ, стремящегося к независимости."
Детектив,1. Расследование убийства: Частный сыщик против серийного убийцы. "2. Коррупция в полиции: Полицейский инспектор против коррумпированных коллег.","3. Семейные тайны: Журналист-расследователь против влиятельной семьи, скрывающей преступления.","4. Судебное дело: Адвокат против прокурора в сложном деле.","5. Поиск пропавшего человека: Детектив против похитителя."
Исторический,1. Политический заговор: Король против дворян, стремящихся свергнуть его. "2. Революция: Революционер против правящего режима.","3. Культурные различия: Путешественник против местных традиций и обычаев.","4. Религиозные конфликты: Монах против инквизиции.","5. Война: Солдат против вражеской армии."
Фантастика,"1. Технологическая угроза: Изобретатель против своих собственных изобретений, вышедших из-под контроля.","2. Временные парадоксы: Путешественник во времени против последствий своих действий в прошлом.","3. Суперзлодей: Супергерой против злодея, угрожающего миру.","4. Альтернативная реальность: Ученый против последствий своих экспериментов с параллельными вселенными.","5. Киборг: Полу-человек, полу-машина против общества, не принимающего его."
Триллер,1. Шпионаж: Агент спецслужб против международной шпионской сети. "2. Киберпреступность: Хакер против могущественной корпорации.","3. Журналистское расследование: Журналист против преступного синдиката.","4. Месть: Бывший военный против тех, кто разрушил его жизнь.","5. Психологическая игра: Психолог против серийного убийцы, играющего с его разумом."
Юмор,"1. Недоразумения: Комедийный актер против нелепых ситуаций, в которые он попадает.","2. Неудачные изобретения: Неудачливый изобретатель против последствий своих экспериментов.","3. Спор: Саркастичный кот против своего хозяина.","4. Романтическое недопонимание: Влюбленный человек против своих страхов и неуверенности.","5. Борьба за внимание: Суперфанат против своего кумира."`,

            'Этапы сюжета': `Этап,Действия
1. Идея,- Найдите свою идею- Сформулируйте замысел- Проверьте его на прочность
2. Логлайн,- Напишите логлайн (краткое описание сюжета)
3. Синопсис,- Составьте синопсис (расширенное описание сюжета)
4. Структура,- Разделите сюжет на акты- Определите ключевые события каждого акта
5. Персонажи,- Создайте персонажей- Определите их мотивации и арки развития
6. Сцены,- Напишите основные сцены- Определите их последовательность и взаимосвязь
7. Диалоги,"- Напишите диалоги- Убедитесь, что они раскрывают характеры и продвигают сюжет"
8. Редактирование,- Проверьте сценарий на логичность и связность- Внесите необходимые правки
9. Тестирование,- Получите обратную связь от тестировщиков- Внесите изменения на основе отзывов`,

            'Этапы (Доп)': `Этап,Действия
Определение концепции,- Определите тему и жанр- Поймите целевую аудиторию
Создание мира,- Разработайте лор и сеттинг- Создайте многомерных персонажей
Разработка сюжета,- Определите основной сюжет- Разработайте побочные квесты
Интеграция нарратива в геймплей,"- Убедитесь, что сюжетные элементы органично вплетены в игровой процесс- Напишите диалоги и взаимодействия"
Создание атмосферы,- Используйте визуальные элементы- Добавьте звуковое сопровождение
Тестирование и доработка,- Получите обратную связь- Внесите необходимые изменения и доработки`,

            'История/ЛОР': `История/лор
Введение: представление темы и основных персонажей.
Завязка: начало событий, которые приводят к конфликту или проблеме.
Развитие сюжета: последовательность событий, раскрывающих конфликт или проблему.
Кульминация: самый напряжённый момент истории, когда герои сталкиваются с главным вызовом.
Развязка: завершение истории, решение конфликта или проблемы, а также последствия для героев.
Заключение: подведение итогов и возможное продолжение истории.
Основные идеи
Начальная сцена, цепляющая с 1 секунд
таблицу главных и второстепенных персонажей`
        };

        let parsedData = {};

        // 1. Вспомогательная функция для парсинга CSV-строк
        function parseCSV(data) {
            const lines = data.split('\n').filter(line => line.trim() !== '');
            if (lines.length < 2) return [];
            
            const [headerLine, ...dataLines] = lines;
            const dataArrays = [];

            // Простая логика для обработки строк с кавычками, но не идеальна для вложенных кавычек
            dataLines.forEach(line => {
                // Использование регулярного выражения для разделения, учитывая запятые внутри кавычек
                const cells = line.match(/(".*?"|[^",\n]*)(,|$)/g)
                    .map(cell => cell.trim())
                    .map(cell => cell.endsWith(',') ? cell.slice(0, -1) : cell)
                    .map(cell => cell.replace(/^"(.*)"$/, '$1')) // Удаление внешних кавычек
                    .map(cell => cell.trim())
                    .filter(cell => cell !== ''); // Удаление пустых ячеек (например, в конце строки)

                if (cells.length > 0) {
                    dataArrays.push(cells);
                }
            });

            return dataArrays;
        }

        // 2. Функция для подготовки данных
        function prepareData() {
            document.getElementById('loadingIndicator').classList.remove('hidden');

            // 1. Простые списки (Колонка A)
            const simpleLists = [
                'Темы', 'Жанр игры', 'Жанр истории', 'Рисовка', 'Анимация', 'История/ЛОР'
            ];
            simpleLists.forEach(key => {
                const data = parseCSV(csvData[key]);
                parsedData[key] = data.map(row => row[0]).filter(item => item !== 'Жанр' && item !== 'Стиль' && item !== 'Вид анимации' && item !== 'Тип задания' && item !== 'Тема' && item !== 'История/лор' && item !== 'Основные идеи');
            });

            // 2. Сложные списки (Все ячейки, кроме Колонки A)
            const complexLists = [
                'Трагедия ГГ', 'Главный герой', 'Место действия', 'Конфликт персонажей'
            ];
            complexLists.forEach(key => {
                const data = parseCSV(csvData[key]);
                // Объединяем все ячейки со второй колонки (индекс 1) в один плоский массив
                parsedData[key] = data.flatMap(row => row.slice(1).filter(item => item.trim() !== ''));
            });

            // 3. Чувство достижения (Колонка A, но исключаем заголовки и описания)
            const achievementData = parseCSV(csvData['Чувство достижения']);
            parsedData['Чувство достижения'] = achievementData
                .map(row => row[0])
                .filter(item => item !== 'Тип задания' && item !== 'Тип задания,Описание');

            // 4. Этапы сюжета (Конкатенация всех действий)
            const plotStages = parseCSV(csvData['Этапы сюжета']).slice(1);
            const extraStages = parseCSV(csvData['Этапы (Доп)']).slice(1);
            
            const formatActions = (data, title) => {
                const actions = data.map(row => {
                    const stage = row[0];
                    // Разделяем действия, которые начинаются с '-'
                    const details = row.slice(1).join(', ').replace(/-/g, '<br>- ');
                    return `**${stage}:**<br>- ${details}`;
                }).join('<br><br>');
                return actions;
            };

            parsedData['Этапы сюжета'] = formatActions(plotStages, "Основные этапы") + 
                                         '<br><br>---<br><br>' + 
                                         formatActions(extraStages, "Дополнительные этапы");

            document.getElementById('loadingIndicator').classList.add('hidden');
        }

        // 3. Функция для получения случайного элемента
        function getRandomItem(arr) {
            if (!arr || arr.length === 0) return 'Нет данных';
            const index = Math.floor(Math.random() * arr.length);
            return arr[index];
        }

        // 4. Основная функция генерации идеи
        function generateIdea() {
            if (document.getElementById('loadingIndicator').classList.contains('hidden')) {
                document.getElementById('generateBtn').disabled = true;
            } else {
                 // Prevent generation if data is still loading
                return;
            }
            
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = ''; // Очистка предыдущих результатов

            // Выбор 3 случайных типов достижения
            const allAchievements = [...parsedData['Чувство достижения']];
            const selectedAchievements = [];
            while (selectedAchievements.length < 3 && allAchievements.length > 0) {
                const item = getRandomItem(allAchievements);
                if (!selectedAchievements.includes(item)) {
                    selectedAchievements.push(item);
                }
                // Удаляем выбранный элемент, чтобы избежать повторений
                const index = allAchievements.indexOf(item);
                if (index > -1) {
                    allAchievements.splice(index, 1);
                }
            }
            
            const idea = [
                { label: 'Основная Тема', value: getRandomItem(parsedData['Темы']) },
                { label: 'Жанр Игры', value: getRandomItem(parsedData['Жанр игры']) },
                { label: 'Жанр Истории', value: getRandomItem(parsedData['Жанр истории']) },
                { label: 'Рисовка (Стиль)', value: getRandomItem(parsedData['Рисовка']) },
                { label: 'Анимация (Вид)', value: getRandomItem(parsedData['Анимация']) },
                { label: 'Главный Герой', value: getRandomItem(parsedData['Главный герой']) },
                { label: 'Основной Конфликт', value: getRandomItem(parsedData['Конфликт персонажей']) },
                { label: 'Трагедия Героя', value: getRandomItem(parsedData['Трагедия ГГ']) },
                { label: 'Место Действия', value: getRandomItem(parsedData['Место действия']) },
                { label: 'Ключевые Задачи (3)', value: selectedAchievements.join(' <br> ') },
                { label: 'Идея Структуры', value: getRandomItem(parsedData['История/ЛОР']) },
                { label: 'Процесс Разработки Сюжета', value: parsedData['Этапы сюжета'] }
            ];

            // Отображение результатов
            idea.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'result-item';
                
                const labelSpan = document.createElement('span');
                labelSpan.className = 'result-label';
                labelSpan.textContent = item.label;

                const valueSpan = document.createElement('span');
                valueSpan.className = 'result-value';
                valueSpan.innerHTML = item.value;

                itemDiv.appendChild(labelSpan);
                itemDiv.appendChild(valueSpan);
                resultsDiv.appendChild(itemDiv);
            });
            
            document.getElementById('generateBtn').disabled = false;
        }

        // Инициализация данных и привязка кнопки
        window.onload = function() {
            prepareData();
            document.getElementById('generateBtn').addEventListener('click', generateIdea);
            
            // Запускаем первую генерацию автоматически
            generateIdea(); 
        };
    </script>
</body>
</html>
