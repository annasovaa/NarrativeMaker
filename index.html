<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Narrative Maker (–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ù–∞—Ä—Ä–∞—Ç–∏–≤–æ–≤)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à—Ä–∏—Ñ—Ç–∞ –∏ –æ–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–º–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0A0A0E; /* –ì–ª—É–±–æ–∫–∏–π —á–µ—Ä–Ω—ã–π —Ñ–æ–Ω */
            color: #E2E8F0; /* –°–≤–µ—Ç–ª—ã–π —Ç–µ–∫—Å—Ç */
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫/–≥—Ä—É–ø–ø */
        .group-card {
            background-color: #1A1A23; /* –¢–µ–º–Ω–æ-—Å–∏–Ω–∏–π/—Ç–µ–º–Ω—ã–π –∞–∫—Ü–µ–Ω—Ç */
            border-left: 4px solid #3B82F6; /* –°–∏–Ω–∏–π –∞–∫—Ü–µ–Ω—Ç –¥–ª—è –ª–µ–≤–æ–π –≥—Ä–∞–Ω–∏—Ü—ã */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω–æ–π –∫–Ω–æ–ø–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ */
        #generate-button {
            background: linear-gradient(135deg, #1D4ED8 0%, #3B82F6 100%); /* –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Å–∏–Ω–∏–π */
            box-shadow: 0 10px 20px rgba(66, 153, 225, 0.5);
            transition: transform 0.1s ease-in-out, box-shadow 0.3s ease;
            z-index: 50;
        }
        #generate-button:hover {
            background: linear-gradient(135deg, #2563EB 0%, #60A5FA 100%);
            transform: scale(1.05);
        }
        #generate-button:active {
            transform: scale(0.95);
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–∫–æ–Ω–∫–∏ –∑–∞–º–∫–∞ */
        .lock-icon {
            transition: color 0.2s ease;
            cursor: pointer;
        }
        .lock-icon.locked {
            color: #F87171; /* –ö—Ä–∞—Å–Ω—ã–π –¥–ª—è –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è */
        }
        .lock-icon.unlocked {
            color: #6B7280; /* –°–µ—Ä—ã–π –¥–ª—è –Ω–µ–∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω–æ–≥–æ */
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤–≤–æ–¥–∞ */
        .narrative-value {
            background-color: #0A0A0E;
            color: #D1D5DB;
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∏—Ç–æ–≥–æ–≤–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ */
        #narrative-summary {
            min-height: 250px;
            background-color: #0A0A0E;
            border: 1px solid #374151;
            white-space: pre-wrap;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        /* –°–∫—Ä–æ–ª–ª–±–∞—Ä –¥–ª—è —Ç–µ–º–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background: #374151;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #4B5563;
        }
        ::-webkit-scrollbar-track {
            background: #1A1A23;
        }

    </style>
</head>
<body class="p-4 md:p-8">

    <header class="mb-10 text-center">
        <h1 class="text-4xl font-extrabold text-white mb-2">Narrative Maker</h1>
        <p class="text-lg text-blue-400">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è –¥–ª—è –ø–∏—Å–∞—Ç–µ–ª–µ–π –∏ –≥–µ–π–º–¥–∏–∑–∞–π–Ω–µ—Ä–æ–≤</p>
    </header>

    <main id="generator-container" class="max-w-4xl mx-auto">
        <!-- –ü–æ–ª—è –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –∑–¥–µ—Å—å —Å –ø–æ–º–æ—â—å—é JavaScript -->
    </main>

    <div class="max-w-4xl mx-auto mt-12 pt-6">
        <h2 class="text-2xl font-bold text-blue-300 mb-4 border-b border-gray-700 pb-2">–ò—Ç–æ–≥–æ–≤—ã–π –ù–∞—Ä—Ä–∞—Ç–∏–≤</h2>
        <pre id="narrative-summary" class="p-4 rounded-lg overflow-auto"></pre>
    </div>

    <!-- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ -->
    <button id="generate-button" class="fixed bottom-4 right-4 md:bottom-8 md:right-8 w-16 h-16 rounded-full flex items-center justify-center text-white text-3xl font-bold shadow-2xl">
        <span class="text-white transform transition duration-200" id="generate-icon">üîÑ</span>
    </button>

    <!-- –ö–Ω–æ–ø–∫–∞ –ó–∞–∫—Ä–µ–ø–∏—Ç—å/–°–Ω—è—Ç—å –≤—Å–µ -->
    <button id="toggle-all-locks-button" class="fixed bottom-24 right-4 md:bottom-28 md:right-8 p-3 bg-gray-700 text-sm text-gray-200 rounded-lg shadow-xl hover:bg-gray-600 transition-colors duration-200">
        –ó–∞–∫—Ä–µ–ø–∏—Ç—å/–°–Ω—è—Ç—å –≤—Å–µ
    </button>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
        const STATE = {}; // { groupKey: { fieldKey: { value: '...', locked: false } } }
        let ALL_LOCKED = false;

        // --- 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –î–∞–Ω–Ω—ã—Ö (–∏–∑–≤–ª–µ—á–µ–Ω–æ –∏–∑ CSV-—Ñ–∞–π–ª–æ–≤) ---
        const DATA = {
            "–û—Å–Ω–æ–≤–Ω–æ–µ": {
                "–¢–µ–º–∞": [
                    "–§—ç–Ω—Ç–µ–∑–∏", "–ö–∏–±–µ—Ä–ø–∞–Ω–∫", "–î–µ—Ç–µ–∫—Ç–∏–≤", "–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –æ–ø–µ—Ä–∞", "–ú–∏—Ñ–æ–ª–æ–≥–∏—è", "–í—ã–∂–∏–≤–∞–Ω–∏–µ", 
                    "–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è", "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ç—Ä–∏–ª–ª–µ—Ä", "–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è"
                ],
                "–ù–∞–∑–≤–∞–Ω–∏–µ": [
                    "–ö—Ä–∏—Å—Ç–∞–ª–ª –ó–∞–±–≤–µ–Ω–∏—è", "–¢–µ–Ω—å –ö–æ—Ä–ø–æ—Ä–∞—Ü–∏–∏", "–ü–æ—Å–ª–µ–¥–Ω–∏–π –°–≤–∏–¥–µ—Ç–µ–ª—å", "–î–æ—Ä–æ–≥–∞ –∫ –∑–≤–µ–∑–¥–∞–º", "–≠—Ö–æ –¢–∏—Ç–∞–Ω–æ–≤",
                    "–ì–∏–±–µ–ª—å –ì–µ—Ä–æ—è", "–ú–∞—à–∏–Ω–∞ –í—Ä–µ–º–µ–Ω–∏", "–¢–∞–π–Ω–∞ –°—Ç–∞—Ä–æ–≥–æ –õ–µ—Å–∞", "–ß–µ—Ä–Ω–∞—è –ú–µ—Å—Ç—å"
                ],
                "–ñ–∞–Ω—Ä –∏–≥—Ä—ã": [
                    "–†–æ–ª–µ–≤—ã–µ –∏–≥—Ä—ã (RPG)", "–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è (Adventure)", "–®—É—Ç–µ—Ä—ã (Shooter)", "–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ (Strategy)", 
                    "–°–∏–º—É–ª—è—Ç–æ—Ä—ã (Simulation)", "–•–æ—Ä—Ä–æ—Ä (Horror)", "–§–∞–π—Ç–∏–Ω–≥ (Fighting)", "–ü–∞–∑–ª—ã (Puzzle)"
                ],
                "–ñ–∞–Ω—Ä –∏—Å—Ç–æ—Ä–∏–∏": [
                    "–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞", "–î–µ—Ç–µ–∫—Ç–∏–≤", "–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π —Ä–æ–º–∞–Ω", "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ç—Ä–∏–ª–ª–µ—Ä", "–Æ–º–æ—Ä", 
                    "–õ—é–±–æ–≤–Ω—ã–π —Ä–æ–º–∞–Ω", "–§–æ–ª—å–∫–ª–æ—Ä", "–ú–µ–º—É–∞—Ä—ã"
                ],
                "–†–∏—Å–æ–≤–∫–∞": [
                    "–†–µ–∞–ª–∏–∑–º", "–ú—É–ª—å—Ç—è—à–Ω—ã–π (Cartoon)", "–ü–∏–∫—Å–µ–ª—å-–∞—Ä—Ç (Pixel Art)", "–ê–Ω–∏–º–µ (Anime)", "–ö–∏–±–µ—Ä–ø–∞–Ω–∫ (Cyberpunk)",
                    "–§—ç–Ω—Ç–µ–∑–∏ (Fantasy)", "–ì–æ—Ç–∏—á–µ—Å–∫–∏–π (Gothic)", "–ö–ª–µ—Ç–æ—á–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è (Cel-Shaded)"
                ],
            },
            "–ì–ª–∞–≤–Ω—ã–π –≥–µ—Ä–æ–π": {
                "–ö—Ç–æ –æ–Ω": [
                    "–≠–ª—å—Ñ–∏–π—Å–∫–∏–π –º–∞–≥", "–î—Ä–∞–∫–æ–Ω–æ–±–æ—Ä–µ—Ü", "–ü—Ä–∏–Ω—Ü–µ—Å—Å–∞-–≤–æ–∏—Ç–µ–ª—å–Ω–∏—Ü–∞", "–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å",
                    "–ö–∏–±–µ—Ä–Ω–µ—Ç–∏—á–µ—Å–∫–∏–π –¥–µ—Ç–µ–∫—Ç–∏–≤", "–ß–∞—Å—Ç–Ω—ã–π —Å—ã—â–∏–∫", "–ê–≥–µ–Ω—Ç —Å–ø–µ—Ü—Å–ª—É–∂–±", "–•–∞–∫–µ—Ä", "–ù–µ—É–¥–∞—á–ª–∏–≤—ã–π –∏–∑–æ–±—Ä–µ—Ç–∞—Ç–µ–ª—å"
                ],
                "–ü–æ–ª": ["–ú—É–∂—á–∏–Ω–∞", "–ñ–µ–Ω—â–∏–Ω–∞", "–ë–µ—Å–ø–æ–ª—ã–π"],
                "–í–æ–∑—Ä–∞—Å—Ç": { type: 'range', min: 18, max: 65, unit: ' –ª–µ—Ç' },
                "–°–æ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å": ["–î–≤–æ—Ä—è–Ω–∏–Ω", "–ò–∑–≥–æ–π", "–ú–∏–ª–ª–∏–∞—Ä–¥–µ—Ä", "–û—Ñ–∏—Å–Ω—ã–π —Ä–∞–±–æ—Ç–Ω–∏–∫", "–°—Ç—É–¥–µ–Ω—Ç", "–ë–µ–∑—Ä–∞–±–æ—Ç–Ω—ã–π"],
                "–¢—Ä–∞–≥–µ–¥–∏—è": [
                    "–ü–æ—Ç–µ—Ä—è–ª –º–∞–≥–∏—á–µ—Å–∫—É—é —Å–∏–ª—É", "–û–∫–∞–∑–∞–ª—Å—è –¥–æ—á–µ—Ä—å—é –∑–ª–æ–≥–æ –∫–æ–ª–¥—É–Ω–∞", "–°–æ–∑–¥–∞–ª –ò–ò, –∫–æ—Ç–æ—Ä—ã–π —É–Ω–∏—á—Ç–æ–∂–∏–ª –ª—é–¥–µ–π",
                    "–õ—É—á—à–∏–π –¥—Ä—É–≥ –æ–∫–∞–∑–∞–ª—Å—è —É–±–∏–π—Ü–µ–π", "–õ—é–±–æ–≤—å –≤—Å–µ–π –∂–∏–∑–Ω–∏ —É–º–µ—Ä–ª–∞", "–°—Ç–∞–ª –æ–¥–µ—Ä–∂–∏–º—ã–º –¥–µ–º–æ–Ω–æ–º",
                    "–ë—ã–ª –ø—Ä–µ–¥–∞–Ω –Ω–∞–ø–∞—Ä–Ω–∏–∫–æ–º", "–¢–µ—Ä—è–µ—Ç —Ä–∞—Å—Å—É–¥–æ–∫ –æ—Ç —Å—Ç—Ä–µ—Å—Å–∞"
                ],
                "–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞ –ª–∏—á–Ω–æ—Å—Ç–∏": ["–•—Ä–∞–±—Ä—ã–π", "–ú—É–¥—Ä—ã–π", "–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–π", "–û–ø—Ç–∏–º–∏—Å—Ç", "–í–µ—Ä–Ω—ã–π", "–ì–µ–Ω–∏–∞–ª—å–Ω—ã–π"],
                "–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞ –ª–∏—á–Ω–æ—Å—Ç–∏": ["–í—ã—Å–æ–∫–æ–º–µ—Ä–Ω—ã–π", "–ú—Å—Ç–∏—Ç–µ–ª—å–Ω—ã–π", "–ù–∞–∏–≤–Ω—ã–π", "–õ–µ–Ω—Ç—è–π", "–°–∫—Ä—ã—Ç–Ω—ã–π", "–í—Å–ø—ã–ª—å—á–∏–≤—ã–π"],
                "–ñ–µ–ª–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞": ["–°–ø–∞—Å—Ç–∏ –º–∏—Ä", "–û—Ç–æ–º—Å—Ç–∏—Ç—å", "–ù–∞–π—Ç–∏ –ª—é–±–æ–≤—å", "–î–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ—é –Ω–µ–≤–∏–Ω–æ–≤–Ω–æ—Å—Ç—å", "–°—Ç–∞—Ç—å –±–µ—Å—Å–º–µ—Ä—Ç–Ω—ã–º"],
                "–ü—Ä–æ—Ñ–µ—Å—Å–∏—è": ["–í–æ–∏–Ω", "–ú–∞–≥", "–î–µ—Ç–µ–∫—Ç–∏–≤", "–ü–æ–ª–∏—Ü–µ–π—Å–∫–∏–π", "–ò–Ω–∂–µ–Ω–µ—Ä", "–•—É–¥–æ–∂–Ω–∏–∫", "–ü–æ–≤–∞—Ä", "–°–Ω–∞–π–ø–µ—Ä", "–®—Ç—É—Ä–º–∞–Ω"],
            },
            "–ü–µ—Ä—Å–æ–Ω–∞–∂–∏ –¥—Ä—É–≥–∏–µ": {
                "–ü–æ–ª": ["–ú—É–∂—á–∏–Ω–∞", "–ñ–µ–Ω—â–∏–Ω–∞", "–ë–µ—Å–ø–æ–ª—ã–π"],
                "–í–æ–∑—Ä–∞—Å—Ç": { type: 'range', min: 20, max: 80, unit: ' –ª–µ—Ç' },
                "–°–æ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å": ["–ö–æ—Ä–æ–ª—å", "–ù–∞—ë–º–Ω–∏–∫", "–£—á–µ–Ω—ã–π", "–ñ–µ–Ω–∞/–ú—É–∂", "–í—Ä–∞–≥", "–ù–∞—Å—Ç–∞–≤–Ω–∏–∫"],
                "–¢—Ä–∞–≥–µ–¥–∏—è": [
                    "–ü—Ä–æ–∫–ª—è—Ç–∏–µ —Ä–æ–¥–∞", "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∫—Ä–∞—Ö", "–ü–æ—Ç–µ—Ä—è –ø–∞–º—è—Ç–∏", "–°—Ç–∞–ª –∫–∏–±–æ—Ä–≥–æ–º –ø—Ä–æ—Ç–∏–≤ —Å–≤–æ–µ–π –≤–æ–ª–∏",
                    "–ù–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–º–µ—Å—Ç–µ —Å –ª—é–±–∏–º—ã–º", "–°–ª—É—á–∞–π–Ω–æ —É–Ω–∏—á—Ç–æ–∂–∏–ª –≥–æ—Ä–æ–¥", "–ü–æ—Å—Ç–∞–≤–ª–µ–Ω –ø–µ—Ä–µ–¥ –≤—ã–±–æ—Ä–æ–º"
                ],
                "–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞ –ª–∏—á–Ω–æ—Å—Ç–∏": ["–ù–∞–¥–µ–∂–Ω—ã–π", "–ß–µ—Å—Ç–Ω—ã–π", "–•–∞—Ä–∏–∑–º–∞—Ç–∏—á–Ω—ã–π", "–£–º–Ω—ã–π", "–î–æ–±—Ä—ã–π", "–¶–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª–µ–Ω–Ω—ã–π"],
                "–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞ –ª–∏—á–Ω–æ—Å—Ç–∏": ["–õ–∂–∏–≤—ã–π", "–ú–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä", "–ó–∞–≤–∏—Å—Ç–ª–∏–≤—ã–π", "–≠–≥–æ–∏—Å—Ç", "–¢—Ä—É—Å–ª–∏–≤—ã–π", "–¶–∏–Ω–∏—á–Ω—ã–π"],
                "–ñ–µ–ª–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞": ["–ó–∞—Ö–≤–∞—Ç–∏—Ç—å –≤–ª–∞—Å—Ç—å", "–ó–∞—â–∏—Ç–∏—Ç—å —Å–µ–º—å—é", "–ü–æ–ª—É—á–∏—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç", "–í–µ—Ä–Ω—É—Ç—å –ø—Ä–æ—à–ª–æ–µ", "–†–∞—Å–∫—Ä—ã—Ç—å —Ç–∞–π–Ω—É"],
                "–ü—Ä–æ—Ñ–µ—Å—Å–∏—è": ["–®–ø–∏–æ–Ω", "–ö—Ä–∏–º–∏–Ω–∞–ª—å–Ω—ã–π –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç", "–ê–¥–≤–æ–∫–∞—Ç", "–í—Ä–∞—á", "–ñ—É—Ä–Ω–∞–ª–∏—Å—Ç", "–ò—Å—Ç–æ—Ä–∏–∫", "–ö–∞—Ç–∞–ª–∞", "–¢–µ—Ö–Ω–∏–∫"],
            },
            "–ú–µ—Å—Ç–æ –¥–µ–π—Å—Ç–≤–∏—è": {
                "–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–º–µ—â–µ–Ω–∏—è": [
                    "–í–æ–ª—à–µ–±–Ω—ã–π –ª–µ—Å", "–°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—ã–π –∑–∞–º–æ–∫", "–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è —Å—Ç–∞–Ω—Ü–∏—è", "–ü–æ—Å—Ç–∞–ø–æ–∫–∞–ª–∏–ø—Ç–∏—á–µ—Å–∫–∏–π –≥–æ—Ä–æ–¥",
                    "–ó–∞–±—Ä–æ—à–µ–Ω–Ω—ã–π –∑–∞–≤–æ–¥", "–û—Ñ–∏—Å", "–®–∫–æ–ª–∞", "–ü–æ–¥–∑–µ–º–Ω—ã–π –±—É–Ω–∫–µ—Ä", "–Ø—Ö—Ç–∞ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –º–æ—Ä–µ"
                ],
                "–¶–≤–µ—Ç": ["–ì–ª—É–±–æ–∫–∏–π —Å–∏–Ω–∏–π", "–¢—É—Å–∫–ª—ã–π –∑–µ–ª–µ–Ω—ã–π", "–Ø—Ä–∫–∏–π –∫—Ä–∞—Å–Ω—ã–π", "–ú—Ä–∞—á–Ω—ã–π —Å–µ—Ä—ã–π", "–ù–µ–æ–Ω–æ–≤—ã–π —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π"],
                "–°–≤–µ—Ç": ["–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Å–≤–µ—Ç", "–†–∞—Å—Å–µ—è–Ω–Ω—ã–π —Å–≤–µ—Ç", "–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ"],
                "–ó–≤—É–∫": ["–ó–≤—É–∫–æ–≤—ã–µ —É–¥–∞—Ä—ã (–≥—Ä–æ—Ö–æ—Ç)", "–®—É–º—ã (—à–µ–ø–æ—Ç)", "–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –∑–≤—É–∫–∏ (–º–µ–ª–æ–¥–∏—è)"],
                "–ó–∞–ø–∞—Ö": ["–¶–≤–µ—Ç–æ—á–Ω—ã–µ", "–í–æ—Å—Ç–æ—á–Ω—ã–µ", "–¶–∏—Ç—Ä—É—Å–æ–≤—ã–µ", "–•–≤–æ–π–Ω—ã–µ", "–ó–∞—Ç—Ö–ª–æ—Å—Ç—å", "–ú–µ—Ç–∞–ª–ª", "–°–≤–µ–∂–µ—Å—Ç—å"],
                "–¢–∞–∫—Ç–∏–ª—å–Ω–æ—Å—Ç—å": ["–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ (–≥–ª–∞–¥–∫–∏–π)", "–ë–æ–ª—å–Ω–æ (–∫–æ–ª—é—á–∏–π)", "–ü—Ä–∏—è—Ç–Ω–æ (–º—è–≥–∫–∏–π)"],
                "–í–∫—É—Å": ["–ì–æ—Ä—å–∫–∏–π (–ø—ã–ª—å)", "–°–ª–∞–¥–∫–∏–π (–º–µ–¥)", "–ö–∏—Å–ª—ã–π (–ª–∏–º–æ–Ω)", "–ü—Ä–µ—Å–Ω—ã–π (–≤–æ–¥–∞)", "–û—Å—Ç—Ä—ã–π (–ø–µ—Ä–µ—Ü)"],
                "–í—ã—Å–æ—Ç–∞": { type: 'range', min: 2, max: 15, unit: ' –º–µ—Ç—Ä–æ–≤' },
                "–®–∏—Ä–∏–Ω–∞": { type: 'range', min: 5, max: 50, unit: ' –º–µ—Ç—Ä–æ–≤' },
            },
            "–¢–∞–π–Ω–∞": {
                "–∫—Ç–æ/—á—Ç–æ (–ò–º–µ–Ω–∏—Ç–µ–ª—å–Ω—ã–π)": ["–î—Ä–µ–≤–Ω–µ–µ –∑–ª–æ", "–ü–æ—Ç–µ—Ä—è–Ω–Ω—ã–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç", "–î–≤–æ–π–Ω–æ–π –∞–≥–µ–Ω—Ç", "–ü—Ä–æ–ø–∞–≤—à–∏–π —Ä–µ–±–µ–Ω–æ–∫", "–°–µ–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–æ–µ–∫—Ç"],
                "–∫–æ–≥–æ/—á–µ–≥–æ (–†–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π)": ["–û—Ç–∫—Ä—ã—Ç–∏–µ –¥—Ä–µ–≤–Ω–µ–π –≥—Ä–æ–±–Ω–∏—Ü—ã", "–£–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ —Ü–µ–ª–æ–π –ø–ª–∞–Ω–µ—Ç—ã", "–°–º–µ—Ä—Ç–∏ –Ω–∞–ø–∞—Ä–Ω–∏–∫–∞", "–ü—Ä–µ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –≤ —Ä—è–¥–∞—Ö"],
            },
            "–ö–æ–Ω—Ñ–ª–∏–∫—Ç": {
                "–ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π": [
                    "–ë–æ—Ä—å–±–∞ –∑–∞ —Ç—Ä–æ–Ω", "–ú–∞–≥–∏—á–µ—Å–∫–∞—è –¥—É—ç–ª—å", "–í–æ—Å—Å—Ç–∞–Ω–∏–µ —Ä–æ–±–æ—Ç–æ–≤", "–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –≤–æ–π–Ω–∞", "–†–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —É–±–∏–π—Å—Ç–≤–∞",
                    "–®–ø–∏–æ–Ω–∞–∂", "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∏–≥—Ä–∞"
                ],
                "–ö–æ–Ω—Ñ–ª–∏–∫—Ç –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤": [
                    "–°–ø–∞—Å–µ–Ω–∏–µ –ª–∏—á–Ω–æ–≥–æ vs. —Å–ø–∞—Å–µ–Ω–∏–µ –º–∏—Ä–∞", "–ó–∞–∫–æ–Ω vs. –°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å", "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ vs. –ü—Ä–∏—Ä–æ–¥–∞",
                    "–ü—Ä–æ—à–ª–æ–µ vs. –ë—É–¥—É—â–µ–µ", "–í–µ—Ä–∞ vs. –ó–Ω–∞–Ω–∏–µ"
                ],
            }
        };

        // --- 2. –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –§—É–Ω–∫—Ü–∏–∏ ---

        /**
         * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª—É—á–∞–π–Ω–æ–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ –≤ –∑–∞–¥–∞–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ.
         * @param {number} min - –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ).
         * @param {number} max - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ).
         * @returns {number}
         */
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        /**
         * –í—ã–±–∏—Ä–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –∏–∑ –º–∞—Å—Å–∏–≤–∞.
         * @param {Array<any>} arr
         * @returns {any}
         */
        function getRandomElement(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        /**
         * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª—É—á–∞–π–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—è.
         * @param {string} groupKey
         * @param {string} fieldKey
         * @returns {string}
         */
        function generateRandomValue(groupKey, fieldKey) {
            const definition = DATA[groupKey][fieldKey];

            if (Array.isArray(definition)) {
                return getRandomElement(definition);
            } else if (definition.type === 'range') {
                const value = getRandomInt(definition.min, definition.max);
                return `${value}${definition.unit}`;
            }
            return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ';
        }

        // --- 3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –°–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏ UI ---

        /**
         * –û–±–Ω–æ–≤–ª—è–µ—Ç UI –ø–æ–ª–µ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ STATE.
         * @param {string} groupKey
         * @param {string} fieldKey
         * @param {string} newValue
         */
        function updateFieldUI(groupKey, fieldKey, newValue) {
            const fieldId = `${groupKey}-${fieldKey}`.replace(/[\s\/\(\)\.]/g, '_');
            const valueElement = document.getElementById(fieldId);
            
            if (valueElement) {
                valueElement.textContent = newValue;
                STATE[groupKey][fieldKey].value = newValue;
            } else {
                 console.error(`–≠–ª–µ–º–µ–Ω—Ç –¥–ª—è ${fieldId} –Ω–µ –Ω–∞–π–¥–µ–Ω.`);
            }
        }

        /**
         * –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–º–∫–∞ –¥–ª—è –ø–æ–ª—è.
         * @param {string} groupKey
         * @param {string} fieldKey
         * @param {boolean} newLockState - –µ—Å–ª–∏ null, —Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç.
         */
        function toggleLock(groupKey, fieldKey, newLockState = null) {
            const state = STATE[groupKey][fieldKey];
            const lockElement = document.getElementById(`lock-${groupKey}-${fieldKey}`.replace(/[\s\/\(\)\.]/g, '_'));
            
            if (newLockState !== null) {
                state.locked = newLockState;
            } else {
                state.locked = !state.locked;
            }

            if (lockElement) {
                lockElement.classList.toggle('locked', state.locked);
                lockElement.classList.toggle('unlocked', !state.locked);
                lockElement.innerHTML = state.locked ? 'üîí' : 'üìå';
                lockElement.title = state.locked ? '–ó–∞–∫—Ä–µ–ø–ª–µ–Ω–æ' : '–ù–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–æ';
            }
        }

        /**
         * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –Ω–µ–∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π.
         */
        function generateAll() {
            // –ê–Ω–∏–º–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏
            const icon = document.getElementById('generate-icon');
            icon.classList.add('animate-spin');
            setTimeout(() => icon.classList.remove('animate-spin'), 500);

            for (const groupKey in DATA) {
                for (const fieldKey in DATA[groupKey]) {
                    if (!STATE[groupKey][fieldKey].locked) {
                        const newValue = generateRandomValue(groupKey, fieldKey);
                        updateFieldUI(groupKey, fieldKey, newValue);
                    }
                }
            }

            updateSummary();
        }
        
        /**
         * –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–º–∫–æ–≤.
         */
        function toggleAllLocks() {
            ALL_LOCKED = !ALL_LOCKED;
            const button = document.getElementById('toggle-all-locks-button');
            button.textContent = ALL_LOCKED ? '–°–Ω—è—Ç—å –≤—Å–µ üîì' : '–ó–∞–∫—Ä–µ–ø–∏—Ç—å –≤—Å–µ üîí';

            for (const groupKey in STATE) {
                for (const fieldKey in STATE[groupKey]) {
                    toggleLock(groupKey, fieldKey, ALL_LOCKED);
                }
            }
        }


        /**
         * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–≤—è–∑–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–∞—Ä—Ä–∞—Ç–∏–≤–∞.
         */
        function updateSummary() {
            const S = STATE;
            const summaryEl = document.getElementById('narrative-summary');

            // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è (–¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –∫–æ–¥–∞)
            const getVal = (g, f) => S[g] && S[g][f] ? S[g][f].value : '–ù/–î';

            const theme = getVal('–û—Å–Ω–æ–≤–Ω–æ–µ', '–¢–µ–º–∞');
            const title = getVal('–û—Å–Ω–æ–≤–Ω–æ–µ', '–ù–∞–∑–≤–∞–Ω–∏–µ');
            const gameGenre = getVal('–û—Å–Ω–æ–≤–Ω–æ–µ', '–ñ–∞–Ω—Ä –∏–≥—Ä—ã');
            const storyGenre = getVal('–û—Å–Ω–æ–≤–Ω–æ–µ', '–ñ–∞–Ω—Ä –∏—Å—Ç–æ—Ä–∏–∏');
            const drawing = getVal('–û—Å–Ω–æ–≤–Ω–æ–µ', '–†–∏—Å–æ–≤–∫–∞');

            const ggWho = getVal('–ì–ª–∞–≤–Ω—ã–π –≥–µ—Ä–æ–π', '–ö—Ç–æ –æ–Ω');
            const ggSex = getVal('–ì–ª–∞–≤–Ω—ã–π –≥–µ—Ä–æ–π', '–ü–æ–ª');
            const ggAge = getVal('–ì–ª–∞–≤–Ω—ã–π –≥–µ—Ä–æ–π', '–í–æ–∑—Ä–∞—Å—Ç');
            const ggStatus = getVal('–ì–ª–∞–≤–Ω—ã–π –≥–µ—Ä–æ–π', '–°–æ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å');
            const ggTragedy = getVal('–ì–ª–∞–≤–Ω—ã–π –≥–µ—Ä–æ–π', '–¢—Ä–∞–≥–µ–¥–∏—è');
            const ggPlus = getVal('–ì–ª–∞–≤–Ω—ã–π –≥–µ—Ä–æ–π', '–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞ –ª–∏—á–Ω–æ—Å—Ç–∏');
            const ggMinus = getVal('–ì–ª–∞–≤–Ω—ã–π –≥–µ—Ä–æ–π', '–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞ –ª–∏—á–Ω–æ—Å—Ç–∏');
            const ggDesire = getVal('–ì–ª–∞–≤–Ω—ã–π –≥–µ—Ä–æ–π', '–ñ–µ–ª–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞');
            const ggProf = getVal('–ì–ª–∞–≤–Ω—ã–π –≥–µ—Ä–æ–π', '–ü—Ä–æ—Ñ–µ—Å—Å–∏—è');

            const allyStatus = getVal('–ü–µ—Ä—Å–æ–Ω–∞–∂–∏ –¥—Ä—É–≥–∏–µ', '–°–æ—Ü–∏–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å');
            const allyProf = getVal('–ü–µ—Ä—Å–æ–Ω–∞–∂–∏ –¥—Ä—É–≥–∏–µ', '–ü—Ä–æ—Ñ–µ—Å—Å–∏—è');
            const allyDesire = getVal('–ü–µ—Ä—Å–æ–Ω–∞–∂–∏ –¥—Ä—É–≥–∏–µ', '–ñ–µ–ª–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞');

            const locationName = getVal('–ú–µ—Å—Ç–æ –¥–µ–π—Å—Ç–≤–∏—è', '–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–º–µ—â–µ–Ω–∏—è');
            const locationColor = getVal('–ú–µ—Å—Ç–æ –¥–µ–π—Å—Ç–≤–∏—è', '–¶–≤–µ—Ç');
            const locationLight = getVal('–ú–µ—Å—Ç–æ –¥–µ–π—Å—Ç–≤–∏—è', '–°–≤–µ—Ç');
            const locationSound = getVal('–ú–µ—Å—Ç–æ –¥–µ–π—Å—Ç–≤–∏—è', '–ó–≤—É–∫');
            const locationSmell = getVal('–ú–µ—Å—Ç–æ –¥–µ–π—Å—Ç–≤–∏—è', '–ó–∞–ø–∞—Ö');
            const locationHeight = getVal('–ú–µ—Å—Ç–æ –¥–µ–π—Å—Ç–≤–∏—è', '–í—ã—Å–æ—Ç–∞');

            const mysteryWhat = getVal('–¢–∞–π–Ω–∞', '–∫—Ç–æ/—á—Ç–æ (–ò–º–µ–Ω–∏—Ç–µ–ª—å–Ω—ã–π)');
            const mysteryGenitive = getVal('–¢–∞–π–Ω–∞', '–∫–æ–≥–æ/—á–µ–≥–æ (–†–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π)');

            const conflictChar = getVal('–ö–æ–Ω—Ñ–ª–∏–∫—Ç', '–ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π');
            const conflictInterest = getVal('–ö–æ–Ω—Ñ–ª–∏–∫—Ç', '–ö–æ–Ω—Ñ–ª–∏–∫—Ç –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤');

            const summaryText = `
–ù–∞–∑–≤–∞–Ω–∏–µ: "${title}"
–¢–µ–º–∞: ${theme}
–ñ–∞–Ω—Ä (–ò–≥—Ä–∞/–ò—Å—Ç–æ—Ä–∏—è): ${gameGenre} / ${storyGenre}
–†–∏—Å–æ–≤–∫–∞: ${drawing}
--------------------------------------------------

–ì–õ–ê–í–ù–´–ô –ì–ï–†–û–ô
–†–æ–ª—å: ${ggWho} (${ggProf})
–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏: ${ggSex}, ${ggAge}, —Å—Ç–∞—Ç—É—Å "${ggStatus}".
–õ–∏—á–Ω–æ—Å—Ç—å: ${ggPlus} (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ) –∏ ${ggMinus} (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ).
–ú–æ—Ç–∏–≤–∞—Ü–∏—è (–ñ–µ–ª–∞–Ω–∏–µ): ${ggDesire}.
–¢—Ä–∞–≥–µ–¥–∏—è (–ü—Ä–µ–¥–∏—Å—Ç–æ—Ä–∏—è): ${ggTragedy}.

–í–¢–û–†–û–°–¢–ï–ü–ï–ù–ù–´–ô –ü–ï–†–°–û–ù–ê–ñ (–∞–Ω—Ç–∞–≥–æ–Ω–∏—Å—Ç/—Å–æ—é–∑–Ω–∏–∫)
–†–æ–ª—å: ${allyStatus} (${allyProf})
–ú–æ—Ç–∏–≤–∞—Ü–∏—è (–ñ–µ–ª–∞–Ω–∏–µ): ${allyDesire}.

–ú–ï–°–¢–û –î–ï–ô–°–¢–í–ò–Ø: ${locationName}
–û–ø–∏—Å–∞–Ω–∏–µ: ${locationHeight} –≤ –≤—ã—Å–æ—Ç—É, ${locationColor} —Ü–≤–µ—Ç, ${locationLight}.
–û—â—É—â–µ–Ω–∏—è: –ó–≤—É–∫ ‚Äì ${locationSound}, –ó–∞–ø–∞—Ö ‚Äì ${locationSmell}.

–ö–û–ù–§–õ–ò–ö–¢ –ò –¢–ê–ô–ù–ê
–û—Å–Ω–æ–≤–Ω–æ–π –ö–æ–Ω—Ñ–ª–∏–∫—Ç: ${conflictChar}.
–ö–æ–Ω—Ñ–ª–∏–∫—Ç –ò–Ω—Ç–µ—Ä–µ—Å–æ–≤: ${conflictInterest}.
–¢–∞–π–Ω–∞: –†–∞–∑–≥–∞–¥–∫–∞ ${mysteryWhat} (–∫—Ç–æ/—á—Ç–æ), —Å–≤—è–∑–∞–Ω–Ω–∞—è —Å ${mysteryGenitive} (–∫–æ–≥–æ/—á–µ–≥–æ).
            `.trim();

            summaryEl.textContent = summaryText;
        }


        /**
         * –°–æ–∑–¥–∞–µ—Ç HTML-—Ä–∞–∑–º–µ—Ç–∫—É –¥–ª—è –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø—ã –ø–æ–ª–µ–π.
         * @param {string} groupKey
         * @param {Object} fields - –ü–æ–ª—è –≤ –≥—Ä—É–ø–ø–µ.
         * @returns {string}
         */
        function createGroupHtml(groupKey, fields) {
            let fieldsHtml = '';

            for (const fieldKey in fields) {
                const fieldId = `${groupKey}-${fieldKey}`.replace(/[\s\/\(\)\.]/g, '_');
                const initialValue = generateRandomValue(groupKey, fieldKey);

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è STATE
                if (!STATE[groupKey]) STATE[groupKey] = {};
                STATE[groupKey][fieldKey] = { value: initialValue, locked: false };

                fieldsHtml += `
                    <div class="flex items-center justify-between py-2 border-b border-gray-800">
                        <label for="${fieldId}" class="text-sm font-medium text-gray-300 w-1/3 pr-2">${fieldKey}:</label>
                        <div class="flex-grow flex items-center bg-gray-900 rounded-lg p-2 narrative-value-container">
                            <span id="${fieldId}" class="flex-grow text-white narrative-value">${initialValue}</span>
                        </div>
                        <button 
                            id="lock-${fieldId}" 
                            data-group="${groupKey}" 
                            data-field="${fieldKey}" 
                            class="lock-icon unlocked p-2 ml-3 rounded-full hover:bg-gray-700"
                            title="–ù–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–æ"
                        >
                            üìå
                        </button>
                    </div>
                `;
            }

            const groupId = `group-${groupKey}`.replace(/[\s\/\(\)\.]/g, '_');

            return `
                <section class="group-card rounded-xl p-4 mb-8">
                    <div id="header-${groupId}" class="flex items-center justify-between cursor-pointer group-header">
                        <h2 class="text-xl font-bold text-blue-400">${groupKey}</h2>
                        <span class="text-xl text-blue-300 transform transition duration-300" id="collapse-icon-${groupId}">‚ñº</span>
                    </div>
                    <div id="content-${groupId}" class="pt-4 space-y-2 group-content">
                        ${fieldsHtml}
                    </div>
                </section>
            `;
        }


        // --- 4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---

        function init() {
            const container = document.getElementById('generator-container');
            let fullHtml = '';

            // 1. –°–æ–∑–¥–∞–Ω–∏–µ HTML –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è STATE
            for (const groupKey in DATA) {
                fullHtml += createGroupHtml(groupKey, DATA[groupKey]);
            }
            container.innerHTML = fullHtml;

            // 2. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
            document.getElementById('generate-button').addEventListener('click', generateAll);
            document.getElementById('toggle-all-locks-button').addEventListener('click', toggleAllLocks);

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∑–∞–º–∫–æ–≤ –∏ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è
            for (const groupKey in DATA) {
                const groupId = `group-${groupKey}`.replace(/[\s\/\(\)\.]/g, '_');

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è
                document.getElementById(`header-${groupId}`).addEventListener('click', () => {
                    const content = document.getElementById(`content-${groupId}`);
                    const icon = document.getElementById(`collapse-icon-${groupId}`);
                    content.classList.toggle('hidden');
                    icon.textContent = content.classList.contains('hidden') ? '‚ñ∂Ô∏è' : '‚ñº';
                });

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∑–∞–º–∫–æ–≤
                for (const fieldKey in DATA[groupKey]) {
                    const fieldId = `${groupKey}-${fieldKey}`.replace(/[\s\/\(\)\.]/g, '_');
                    const lockButton = document.getElementById(`lock-${fieldId}`);
                    lockButton.addEventListener('click', (e) => {
                        const gKey = e.currentTarget.getAttribute('data-group');
                        const fKey = e.currentTarget.getAttribute('data-field');
                        toggleLock(gKey, fKey);
                    });
                }
            }
            
            // 3. –ü–µ—Ä–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            generateAll();
        }

        window.onload = init;
    </script>

</body>
</html>
